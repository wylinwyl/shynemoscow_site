<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SHYNEMOSCOW | HOODIE_01</title>
    <link rel="icon" type="image/x-icon" href="/favicon.ico">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Archivo+Black&family=Manrope:wght@400;500;700&family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @keyframes marquee {
            0% { transform: translateX(0); }
            100% { transform: translateX(-50%); }
        }
        .marquee {
            overflow: hidden;
            white-space: nowrap;
        }
        .marquee-wrapper {
            display: inline-flex;
            animation: marquee 30s linear infinite;
        }
        .marquee-content {
            flex-shrink: 0;
        }
        
        .image-gallery {
            position: relative;
            width: 100%;
            max-width: 28rem;
            overflow: hidden;
        }
        .slides {
            display: flex;
            width: 200%;
            transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            touch-action: pan-y pinch-zoom;
        }
        .product-image {
            flex: 0 0 100%;
            width: 100%;
            height: auto;
            object-fit: cover;
            transition: opacity 0.3s ease;
        }
        
        .thumbnail.active {
            border: 2px solid #3d0a05;
            box-sizing: border-box;
        }
        
        .size-btn {
            background-color: transparent;
            color: #3d0a05;
            transition: all 0.2s ease;
        }
        .size-btn.active {
            background-color: #3d0a05;
            color: #fff;
        }
        .size-btn:hover:not(.active) {
            background-color: #f5f5f5;
        }
        
        .product-details {
            border-width: 1px;
            border-color: #e5e7eb;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            transition: all 0.3s ease;
        }
        .product-details:hover {
            box-shadow: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
        }
        
        .modal-overlay {
            background-color: rgba(0, 0, 0, 0.5);
            backdrop-filter: blur(4px);
            z-index: 10; /* Оверлей ниже корзины */
        }
        .cart-modal {
            transform: translateX(100%); /* Начинается за правой границей */
            transition: transform 0.3s ease-in-out;
            box-shadow: -10px 0 15px -3px rgba(0, 0, 0, 0.1), -4px 0 6px -2px rgba(0, 0, 0, 0.05); /* Тень слева */
            z-index: 20;
        }
        .cart-modal.open {
            transform: translateX(0); /* Сдвигается в видимую область */
        }
        .cart-modal.closing {
            transform: translateX(100%); /* Уходит вправо при закрытии */
        }
        
        .dot {
            width: 5px;
            height: 5px;
            background-color: #3d0a05;
            border-radius: 50%;
            display: inline-block;
            margin-right: 8px;
            margin-top: 10px;
        }
        
        body {
            font-family: 'Manrope', sans-serif;
            color: #111827;
        }
        h1, h2, h3, h4 {
            font-family: 'Archivo Black', sans-serif;
            letter-spacing: -0.025em;
            color: #3d0a05; /* Updated color for headers */
        }
        
        .transition-smooth {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
        }
        ::-webkit-scrollbar-thumb {
            background: #888;
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #555;
        }
        
        #popup-image {
            transition: transform 0.2s ease;
            max-width: 100%;
            max-height: 90vh;
            cursor: zoom-in;
        }
        #popup-image.zoomed {
            transform: scale(1.5);
        }
        
        .hidden {
            display: none !important;
        }
        body.modal-open {
            overflow-x: hidden; /* Предотвращаем горизонтальную прокрутку */
        }
        
        @keyframes cart-added {
            0% { transform: scale(1); }
            50% { transform: scale(1.1); }
            100% { transform: scale(1); }
        }
        .cart-added {
            animation: cart-added 0.3s ease;
        }
        
        @media (min-width: 1024px) {
            .product-container {
                flex-direction: row;
                justify-content: center;
                gap: 3rem;
            }
            .image-gallery, .product-details {
                max-width: 28rem;
                width: 100%;
            }
        }
        
        @media (max-width: 768px) {
            .product-details {
                box-shadow: none;
                border: none;
            }
            .header-logo {
                padding-left: 0.5rem !important; /* Минимальный отступ слева */
            }
            .header-cart {
                padding-right: 0.5rem !important; /* Минимальный отступ справа */
            }
            header .flex {
                padding-left: 0.5rem;
                padding-right: 0.5rem;
            }
            #popup-image {
                cursor: default; /* Remove zoom cursor on mobile */
            }
        }

        /* Ensure specified text elements are #3d0a05 */
        .header-logo, .cart-btn span, .product-details h1, .footer-links button, .footer-links a {
            color: #3d0a05 !important;
        }

        /* Cart icon color */
        .cart-btn i {
            color: #3d0a05 !important;
        }
        .color-switch {
            position: relative;
            display: inline-block;
        }

        .color-tooltip {
            pointer-events: none;
            transform: translateX(50%);
            right: 50%;
            z-index: 10;
        }

        .color-square {
            width: 1.25rem;
            height: 1.25rem;
            border-radius: 0.125rem;
            transition: all 0.2s ease;
            outline: 1px solid rgba(0, 0, 0, 0.3);
            outline-offset: 2px;
        }

        .color-switch:hover .color-square {
            transform: scale(1.1);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .color-switch.active .color-square {
            width: 1.5rem;
            height: 1.5rem;
            outline: 1px solid #000000;
            outline-offset: 2px;
            transform: scale(1);
        }
    </style>
</head>
<body class="flex flex-col min-h-screen bg-white antialiased">
    <!-- Header -->
    <header class="sticky top-0 z-20 bg-white border-b border-gray-100">
        <div class="flex justify-between items-center w-full py-4 px-4 lg:px-0">
            <h1 class="text-3xl md:text-4xl font-normal tracking-tighter m-0 p-0 pl-4">
                <a href="main.html" class="block header-logo" style="font-family: Impact, sans-serif;">shynemoscow</a>
            </h1>
            <div class="flex items-center gap-0 pr-4 header-cart">
                <button class="cart-btn px-4 py-2 flex items-center gap-2 hover:bg-gray-100 rounded-md transition-all" aria-label="Открыть корзину">
                    <i class="fas fa-shopping-bag text-lg"></i>
                    <span class="font-normal">КОРЗИНА</span>
                </button>
                <span class="cart-count text-[#3d0a05] text-sm font-medium hidden" aria-live="polite">0</span>
            </div>
        </div>
    </header>

    <!-- Marquee -->
    <div class="marquee bg-[#3d0a05] text-white overflow-hidden py-2">
        <div class="marquee-wrapper">
            <div class="marquee-content whitespace-nowrap text-xs md:text-sm font-medium tracking-wider">
                ЗАКАЗ МОЖНО ОФОРМИТЬ ДО XX.XX.25 ● ЗАКАЗ МОЖНО ОФОРМИТЬ ДО XX.XX.25 ● ЗАКАЗ МОЖНО ОФОРМИТЬ ДО XX.XX.25 ● ЗАКАЗ МОЖНО ОФОРМИТЬ ДО XX.XX.25 ●
            </div>
            <div class="marquee-content whitespace-nowrap text-xs md:text-sm font-medium tracking-wider">
                ЗАКАЗ МОЖНО ОФОРМИТЬ ДО XX.XX.25 ● ЗАКАЗ МОЖНО ОФОРМИТЬ ДО XX.XX.25 ● ЗАКАЗ МОЖНО ОФОРМИТЬ ДО XX.XX.25 ● ЗАКАЗ МОЖНО ОФОРМИТЬ ДО XX.XX.25 ●
            </div>
        </div>
    </div>

    <main class="flex-1 py-8">
        <div class="container mx-auto px-4">
            <div class="product-container flex flex-col lg:flex-row items-center justify-center gap-6 w-full max-w-6xl mx-auto">
                <!-- Image gallery -->
                <div class="image-gallery relative w-full max-w-lg rounded-lg overflow-hidden" role="region" aria-label="Галерея изображений товара">
                    <div class="slides w-full">
                        <img src="hoodie_grey.png" alt="HOODIE_01 Серый" class="product-image w-full h-auto cursor-zoom-in">
                        <img src="hoodie_greyBS.png" alt="HOODIE_01 Серый BS" class="product-image w-full h-auto cursor-zoom-in">
                    </div>
                    <button class="prev-btn absolute left-4 top-1/2 -translate-y-1/2 bg-white/80 hover:bg-white text-[#3d0a05] w-8 h-8 rounded-full flex items-center justify-center shadow transition-smooth" aria-label="Предыдущее изображение">
                        <i class="fas fa-chevron-left text-sm"></i>
                    </button>
                    <button class="next-btn absolute right-4 top-1/2 -translate-y-1/2 bg-white/80 hover:bg-white text-[#3d0a05] w-8 h-8 rounded-full flex items-center justify-center shadow transition-smooth" aria-label="Следующее изображение">
                        <i class="fas fa-chevron-right text-sm"></i>
                    </button>
                    <div class="absolute bottom-4 left-0 right-0 flex justify-center gap-2" role="tablist">
                        <div class="w-2 h-2 rounded-full bg-[#3d0a05] border border-gray-300 dot-indicator active" role="tab" aria-selected="true"></div>
                        <div class="w-2 h-2 rounded-full bg-white/80 border border-gray-300 dot-indicator" role="tab" aria-selected="false"></div>
                    </div>
                </div>

                <!-- Product details -->
                <div class="product-details w-full max-w-lg bg-white p-6 rounded-lg">
                    <div class="mb-6 flex justify-between items-start">
                        <div>
                            <h1 class="text-2xl md:text-3xl font-normal tracking-tighter">HOODIE_01</h1>
                            <p class="text-gray-500 text-sm mt-1">Серый</p>
                        </div>
                        
                        <!-- Updated color switcher block -->
                        <div class="flex flex-col items-end">
                            <span class="text-xs text-gray-500 mb-1">ДРУГОЙ ЦВЕТ</span>
                            <div class="flex gap-2">
                                <a href="hoodie_01black.html" class="color-switch relative group">
                                    <div class="color-square" style="background-color: #412f26;"></div>
                                    <span class="color-tooltip absolute -bottom-8 right-0 bg-black text-white text-xs px-2 py-1 rounded whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity">Коричневый</span>
                                </a>
                                <a href="hoodie_01grey.html" class="color-switch relative group active">
                                    <div class="color-square" style="background-color: #b8b8b8;"></div>
                                    <span class="color-tooltip absolute -bottom-8 right-0 bg-black text-white text-xs px-2 py-1 rounded whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity">Серый</span>
                                </a>
                                <a href="hoodie_01white.html" class="color-switch relative group">
                                    <div class="color-square" style="background-color: #ffffff;"></div>
                                    <span class="color-tooltip absolute -bottom-8 right-0 bg-black text-white text-xs px-2 py-1 rounded whitespace-nowrap opacity-0 group-hover:opacity-100 transition-opacity">Белый</span>
                                </a>
                            </div>
                        </div>
                    </div>
                    <div class="thumbnail-gallery flex gap-3 mb-6">
                        <img src="hoodie_grey.png" class="thumbnail w-14 h-14 object-cover cursor-pointer rounded-sm active" data-index="0" data-color="Серый" alt="Миниатюра HOODIE_01 Серый">
                        <img src="hoodie_greyBS.png" class="thumbnail w-14 h-14 object-cover cursor-pointer rounded-sm" data-index="1" data-color="Серый" alt="Миниатюра HOODIE_01 Серый BS">
                    </div>
                    <div class="mb-6">
                        <ul class="space-y-2 text-sm">
                            <li class="flex items-start"><span class="dot"></span>100% ХЛОПОК 470 ГР</li>
                            <li class="flex items-start"><span class="dot"></span>ПРИНТ ШЕЛКОГРАФИЯ</li>
                            <li class="flex items-start"><span class="dot"></span>ОВЕРСАЙЗ КРОЙ</li>
                            <li class="flex items-start"><span class="dot"></span>УКОРОЧЕННЫЙ СИЛУЭТ</li>
                        </ul>
                    </div>
                    <div class="my-6 text-xs text-gray-600">
                        <p>ПОСАДКА СООТВЕТСТВУЕТ РАЗМЕРУ</p>
                        <p class="mt-1">РОСТ МОДЕЛИ 187, РАЗМЕР НА МОДЕЛИ М.</p>
                    </div>
                    <div class="mb-6">
                        <div class="flex justify-between items-center mb-3">
                            <p class="font-medium text-sm">РАЗМЕРНАЯ СЕТКА</p>
                            <button class="text-xs underline hover:text-gray-600 transition-smooth" id="size-guide-btn" aria-label="Открыть таблицу размеров">ТАБЛИЦА РАЗМЕРОВ</button>
                        </div>
                        <div class="size-selection grid grid-cols-4 gap-2" role="radiogroup" aria-label="Выбор размера">
                            <button class="size-btn px-3 py-2 border border-gray-300 rounded text-sm transition-smooth" role="radio" aria-checked="false">S</button>
                            <button class="size-btn px-3 py-2 border border-gray-300 rounded text-sm transition-smooth active" role="radio" aria-checked="true">M</button>
                            <button class="size-btn px-3 py-2 border border-gray-300 rounded text-sm transition-smooth" role="radio" aria-checked="false">L</button>
                            <button class="size-btn px-3 py-2 border border-gray-300 rounded text-sm transition-smooth" role="radio" aria-checked="false">XL</button>
                        </div>
                    </div>
                    <div class="mt-8">
                        <p class="text-xl font-bold mb-4">4 500 ₽</p>
                        <button class="add-to-cart w-full bg-[#3d0a05] text-white py-3 px-6 hover:bg-[#2c0703] transition-smooth rounded flex items-center justify-center gap-2 text-sm font-medium" aria-label="Добавить в корзину">
                            <i class="fas fa-shopping-bag"></i>
                            <span>В КОРЗИНУ</span>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <!-- Image popup modal -->
    <div id="image-popup" class="fixed inset-0 z-50 modal-overlay hidden flex items-center justify-center p-4" role="dialog" aria-label="Увеличенное изображение">
        <div class="relative w-full max-w-4xl">
            <span class="close-popup absolute -top-10 right-0 text-white text-3xl cursor-pointer hover:text-gray-300 transition-smooth" aria-label="Закрыть изображение">×</span>
            <div class="bg-white rounded-lg overflow-hidden">
                <img id="popup-image" src="" alt="Увеличенное изображение" class="w-full max-h-[90vh] object-contain">
            </div>
        </div>
    </div>

    <!-- Оверлей -->
    <div id="cart-overlay" class="modal-overlay fixed inset-0 z-50 hidden" aria-hidden="true"></div>
    <!-- Корзина -->
    <div id="cart-modal" class="cart-modal fixed right-0 top-0 h-full w-full max-w-md bg-white overflow-y-auto z-50 hidden" role="dialog" aria-label="Корзина">
        <div class="p-6 sticky top-0 bg-white border-b border-gray-100 z-10">
            <div class="flex justify-between items-center mb-4">
                <h2 class="text-xl font-bold">ВАША КОРЗИНА</h2>
                <span class="close-cart text-2xl cursor-pointer hover:text-gray-500 transition-smooth" aria-label="Закрыть корзину">×</span>
            </div>
        </div>
        <div id="cart-items" class="cart-items p-6 space-y-4" aria-live="polite">
            <div class="empty-cart text-center py-12">
                <i class="fas fa-shopping-bag text-3xl text-gray-300 mb-4"></i>
                <p class="text-gray-500">Ваша корзина пуста</p>
            </div>
        </div>
        <div class="cart-footer p-6 sticky bottom-0 bg-white border-t border-gray-200">
            <div class="flex justify-between mb-4">
                <p class="font-medium">Итого</p>
                <p id="cart-total" class="font-bold">0 ₽</p>
            </div>
            <button class="checkout-btn w-full bg-[#3d0a05] text-white py-3 px-6 hover:bg-[#2c0703] transition-smooth rounded text-sm font-medium" aria-label="Оформить заказ">ОФОРМИТЬ ЗАКАЗ</button>
        </div>
    </div>

    <!-- Size guide modal -->
    <div id="size-guide-modal" class="modal hidden fixed inset-0 z-50 modal-overlay flex items-center justify-center p-4" role="dialog" aria-label="Таблица размеров">
        <div class="bg-white p-6 max-w-md rounded-lg w-full">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold">ТАБЛИЦА РАЗМЕРОВ</h3>
                <span class="close-modal text-2xl cursor-pointer hover:text-gray-500 transition-smooth" aria-label="Закрыть таблицу размеров">×</span>
            </div>
            <div class="text-sm">
                <p class="mb-4">Убедитесь в правильном выборе размера, ознакомившись с таблицей:</p>
                <table class="w-full border border-gray-200">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="p-3 text-left border-r border-gray-200 text-sm font-medium">Размер</th>
                            <th class="p-3 text-left text-sm font-medium">Грудь (см)</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr><td class="p-3 border border-gray-200">S</td><td class="p-3 border border-gray-200">110-115</td></tr>
                        <tr class="bg-gray-50"><td class="p-3 border border-gray-200">M</td><td class="p-3 border border-gray-200">115-120</td></tr>
                        <tr><td class="p-3 border border-gray-200">L</td><td class="p-3 border border-gray-200">120-125</td></tr>
                        <tr class="bg-gray-50"><td class="p-3 border border-gray-200">XL</td><td class="p-3 border border-gray-200">125-130</td></tr>
                    </tbody>
                </table>
                <p class="mt-4 text-xs text-gray-500">* Посадка соответствует размеру. Модель носит размер M (рост 187 см).</p>
            </div>
        </div>
    </div>

    <!-- Contacts modal -->
    <div id="contacts-modal" class="modal hidden fixed inset-0 z-50 modal-overlay flex items-center justify-center p-4" role="dialog" aria-label="Контакты">
        <div class="bg-white p-6 max-w-md rounded-lg w-full">
            <div class="flex justify-between items-center mb-4">
                <h3 class="text-lg font-bold">КОНТАКТЫ</h3>
                <span class="close-contacts text-2xl cursor-pointer hover:text-gray-500 transition-smooth" aria-label="Закрыть контакты">×</span>
            </div>
            <div class="text-sm">
                <p class="mb-2">По вопросам пишите на почту:</p>
                <p class="text-base font-medium mb-4"><a href="/cdn-cgi/l/email-protection#d9aab1a0b7bcb4b6aabab6ae99b0b7bbb6a1f7abac" class="hover:text-gray-600 transition-smooth">[email protected]</a></p>
                <p class="mt-4">
                    <a href="https://t.me/shynemoscow" target="_blank" class="inline-flex items-center text-[#3d0a05] hover:text-gray-600 transition-smooth">
                        <i class="fab fa-telegram mr-2"></i> Telegram
                    </a>
                </p>
            </div>
        </div>
    </div>

    <!-- Sticky "back to top" button -->
    <button id="back-to-top" class="fixed bottom-6 right-6 bg-[#3d0a05] text-white w-10 h-10 rounded-full flex items-center justify-center shadow-lg hover:bg-[#2c0703] transition-smooth hidden" aria-label="Вернуться наверх">
        <i class="fas fa-arrow-up text-sm"></i>
    </button>

    <!-- Footer -->
    <footer class="py-6 border-t border-gray-100">
        <div class="container mx-auto px-4 flex flex-col items-center">
            <p class="text-xs text-gray-500 footer-copyright mb-2">© 2025 SHYNEMOSCOW.</p>
            <div class="flex items-center gap-4 footer-links">
                <button id="contacts-btn" class="text-xs underline hover:text-gray-600 transition-smooth" aria-label="Открыть контакты">КОНТАКТЫ</button>
                <a href="offer.html" class="text-xs underline hover:text-gray-600 transition-smooth">ПУБЛИЧНАЯ ОФЕРТА</a>
                <a href="policy.html" class="text-xs underline hover:text-gray-600 transition-smooth">ПОЛИТИКА КОНФИДЕНЦИАЛЬНОСТИ</a>
            </div>
        </div>
    </footer>

    <script data-cfasync="false" src="/cdn-cgi/scripts/5c5dd728/cloudflare-static/email-decode.min.js"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const images = ["hoodie_grey.png", "hoodie_greyBS.png"];
            let currentIndex = 0;
            const slides = document.querySelector(".slides");
            const slideImages = slides.querySelectorAll(".product-image");
            const prevBtn = document.querySelector(".prev-btn");
            const nextBtn = document.querySelector(".next-btn");
            const thumbnails = document.querySelectorAll(".thumbnail");
            const dotIndicators = document.querySelectorAll(".dot-indicator");
            const imagePopup = document.getElementById("image-popup");
            const popupImage = document.getElementById("popup-image");
            const closePopup = document.querySelector(".close-popup");
            const cartModal = document.getElementById("cart-modal");
            const cartOverlay = document.getElementById("cart-overlay");
            const cartBtn = document.querySelector(".cart-btn");
            const closeCart = document.querySelector(".close-cart");
            const addToCartBtn = document.querySelector(".add-to-cart");
            const cartItems = document.getElementById("cart-items");
            const cartTotal = document.getElementById("cart-total");
            const checkoutBtn = document.querySelector(".checkout-btn");
            const sizeButtons = document.querySelectorAll(".size-btn");
            const cartCount = document.querySelector(".cart-count");
            const backToTopBtn = document.getElementById("back-to-top");
            const sizeGuideBtn = document.getElementById("size-guide-btn");
            const sizeGuideModal = document.getElementById("size-guide-modal");
            const closeSizeGuide = document.querySelector(".close-modal");
            const contactsBtn = document.getElementById("contacts-btn");
            const contactsModal = document.getElementById("contacts-modal");
            const closeContacts = document.querySelector(".close-contacts");
            const successPopup = document.getElementById("success-popup");
            const errorPopup = document.getElementById("error-popup");
            const closeSuccessPopupBtn = document.getElementById("close-success-popup");
            const closeErrorPopupBtn = document.getElementById("close-error-popup");

            let selectedSize = "M";
            let cart = JSON.parse(localStorage.getItem("cart")) || [];

            // Динамическая высота main
            function updateMainHeight() {
                const header = document.querySelector("header");
                const marquee = document.querySelector(".marquee");
                const footer = document.querySelector("footer");
                const main = document.querySelector("main");

                const headerHeight = header.offsetHeight;
                const marqueeHeight = marquee.offsetHeight;
                const footerHeight = footer.offsetHeight;

                const totalHeight = headerHeight + marqueeHeight + footerHeight;
                main.style.minHeight = `calc(100vh - ${totalHeight}px)`;
            }

            updateMainHeight();
            window.addEventListener("resize", updateMainHeight);

            updateCartCount();

            // Открытие/закрытие модальных окон
            function openModal(modal, overlay = null) {
                modal.classList.remove("hidden");
                if (overlay) {
                    overlay.classList.remove("hidden");
                }
                setTimeout(() => {
                    if (modal.classList.contains("cart-modal")) {
                        modal.classList.add("open");
                    }
                }, 10);
                document.body.classList.add("modal-open");
                modal.focus();
            }

            function closeModal(modal) {
                modal.classList.add("hidden");
                document.body.classList.remove("modal-open");
            }

            contactsBtn.addEventListener("click", () => openModal(contactsModal));
            closeContacts.addEventListener("click", () => closeModal(contactsModal));
            contactsModal.addEventListener("click", (e) => {
                if (e.target === contactsModal) closeModal(contactsModal);
            });

            sizeGuideBtn.addEventListener("click", () => openModal(sizeGuideModal));
            closeSizeGuide.addEventListener("click", () => closeModal(sizeGuideModal));
            sizeGuideModal.addEventListener("click", (e) => {
                if (e.target === sizeGuideModal) closeModal(sizeGuideModal);
            });

            // Кнопка "наверх"
            window.addEventListener("scroll", () => {
                backToTopBtn.classList.toggle("hidden", window.pageYOffset <= 300);
            });
            backToTopBtn.addEventListener("click", () => {
                window.scrollTo({ top: 0, behavior: "smooth" });
            });

            // Переключение слайдов
            prevBtn.addEventListener("click", () => {
                if (currentIndex > 0) {
                    currentIndex--;
                    updateSlidePosition();
                    updateActiveThumbnail();
                    updateDotIndicator();
                }
            });

            nextBtn.addEventListener("click", () => {
                if (currentIndex < images.length - 1) {
                    currentIndex++;
                    updateSlidePosition();
                    updateActiveThumbnail();
                    updateDotIndicator();
                }
            });

            // Клавиатурная навигация для слайдера
            document.addEventListener("keydown", (e) => {
                if (e.key === "ArrowLeft" && currentIndex > 0) {
                    currentIndex--;
                    updateSlidePosition();
                    updateActiveThumbnail();
                    updateDotIndicator();
                } else if (e.key === "ArrowRight" && currentIndex < images.length - 1) {
                    currentIndex++;
                    updateSlidePosition();
                    updateActiveThumbnail();
                    updateDotIndicator();
                }
            });

            thumbnails.forEach(thumbnail => {
                thumbnail.addEventListener("click", function () {
                    const index = parseInt(this.getAttribute("data-index"));
                    currentIndex = index;
                    updateSlidePosition();
                    updateActiveThumbnail();
                    updateDotIndicator();
                });
            });

            slideImages.forEach(img => {
                img.addEventListener("click", function () {
                    try {
                        popupImage.src = this.src;
                        openModal(imagePopup);
                    } catch (error) {
                        console.error("Ошибка при открытии изображения:", error);
                    }
                });
            });

            closePopup.addEventListener("click", () => closeImagePopup());
            imagePopup.addEventListener("click", function (e) {
                if (!popupImage.contains(e.target)) closeImagePopup();
            });

            // Zoom functionality (disabled on mobile)
            if (window.innerWidth > 768) {
                popupImage.addEventListener("mousemove", function (e) {
                    this.classList.add("zoomed");
                    const rect = this.getBoundingClientRect();
                    const x = ((e.clientX - rect.left) / rect.width) * 100;
                    const y = ((e.clientY - rect.top) / rect.height) * 100;
                    this.style.transformOrigin = `${x}% ${y}%`;
                });

                popupImage.addEventListener("mouseleave", function () {
                    this.classList.remove("zoomed");
                    this.style.transformOrigin = "center center";
                });
            }

            function closeImagePopup() {
                try {
                    closeModal(imagePopup);
                    popupImage.src = "";
                } catch (error) {
                    console.error("Ошибка при закрытии изображения:", error);
                }
            }

            // Открытие корзины
            cartBtn.addEventListener("click", () => {
                openModal(cartModal, cartOverlay);
                updateCart();
            });

            // Закрытие корзины
            closeCart.addEventListener("click", () => {
                cartModal.classList.add("closing");
                cartModal.classList.remove("open");
                setTimeout(() => {
                    cartModal.classList.add("hidden");
                    cartOverlay.classList.add("hidden");
                    cartModal.classList.remove("closing");
                    document.body.classList.remove("modal-open");
                }, 300); // Длительность анимации
            });

            // Закрытие по клику на оверлей
            cartOverlay.addEventListener("click", () => {
                cartModal.classList.add("closing");
                cartModal.classList.remove("open");
                setTimeout(() => {
                    cartModal.classList.add("hidden");
                    cartOverlay.classList.add("hidden");
                    cartModal.classList.remove("closing");
                    document.body.classList.remove("modal-open");
                }, 300);
            });

            // Исправление выбора размера
            sizeButtons.forEach(button => {
                button.addEventListener("click", function () {
                    sizeButtons.forEach(btn => {
                        btn.classList.remove("active");
                        btn.setAttribute("aria-checked", "false");
                    });
                    this.classList.add("active");
                    this.setAttribute("aria-checked", "true");
                    selectedSize = this.textContent.trim();
                });
            });

            // Добавление в корзину
            addToCartBtn.addEventListener("click", function () {
                const price = 4500;
                const firstImage = images[0];
                const color = thumbnails[0].getAttribute("data-color");

                if (!selectedSize) {
                    alert("Пожалуйста, выберите размер");
                    return;
                }

                const existingItem = cart.find(
                    item => item.name === "HOODIE_01" && item.size === selectedSize && item.color === color
                );

                if (existingItem) {
                    existingItem.quantity += 1;
                } else {
                    const item = {
                        name: "HOODIE_01",
                        size: selectedSize,
                        price: price,
                        image: firstImage,
                        color: color,
                        quantity: 1
                    };
                    cart.push(item);
                }

                // Анимация добавления в корзину
                this.classList.add("cart-added");
                const cartIcon = this.querySelector("i");
                cartIcon.classList.add("animate-bounce");
                setTimeout(() => {
                    this.classList.remove("cart-added");
                    cartIcon.classList.remove("animate-bounce");
                }, 1000);

                // Обновление заголовка страницы
                const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
                document.title = `SHYNEMOSCOW | HOODIE_01 (${totalItems} в корзине)`;

                localStorage.setItem("cart", JSON.stringify(cart));
                updateCart();
                updateCartCount();
            });

            checkoutBtn.addEventListener("click", function () {
                if (cart.length === 0) {
                    alert("Корзина пуста");
                    return;
                }
                const total = cart.reduce((sum, item) => sum + item.price * item.quantity, 0);
                window.location.href = `checkout.html?total=${total}`;
            });

            // Свайп
            let touchStartX = 0;
            let touchEndX = 0;

            slides.addEventListener("touchstart", (e) => {
                touchStartX = e.changedTouches[0].screenX;
            });

            slides.addEventListener("touchmove", (e) => {
                e.preventDefault();
                touchEndX = e.changedTouches[0].screenX;
            });

            slides.addEventListener("touchend", (e) => {
                const swipeDistance = touchStartX - touchEndX;
                if (Math.abs(swipeDistance) > 30) {
                    if (swipeDistance > 0 && currentIndex < images.length - 1) {
                        currentIndex++;
                        updateSlidePosition();
                        updateActiveThumbnail();
                        updateDotIndicator();
                    } else if (swipeDistance < 0 && currentIndex > 0) {
                        currentIndex--;
                        updateSlidePosition();
                        updateActiveThumbnail();
                        updateDotIndicator();
                    }
                }
                touchStartX = 0;
                touchEndX = 0;
            });

            function updateCart() {
                cartItems.innerHTML = "";
                let total = 0;

                if (cart.length === 0) {
                    cartItems.innerHTML = `
                        <div class="empty-cart text-center py-12">
                            <i class="fas fa-shopping-bag text-3xl text-gray-300 mb-4"></i>
                            <p class="text-gray-500">Ваша корзина пуста</p>
                        </div>
                    `;
                } else {
                    cart.forEach((item, index) => {
                        const itemTotal = item.price * item.quantity;
                        const cartItem = document.createElement("div");
                        cartItem.classList.add("cart-item", "flex", "py-4", "border-b", "border-gray-100");
                        cartItem.innerHTML = `
                            <img src="${item.image}" alt="${item.name}" class="w-16 h-16 object-cover rounded">
                            <div class="flex-1 ml-4">
                                <div class="flex justify-between">
                                    <h4 class="font-medium text-sm">${item.name}</h4>
                                    <span class="item-total font-medium text-sm">${itemTotal.toLocaleString('ru-RU')} ₽</span>
                                </div>
                                <div class="text-xs text-gray-500 mt-1">
                                    <p>Размер: ${item.size} | Цвет: ${item.color}</p>
                                </div>
                                <div class="quantity-controls flex items-center mt-3">
                                    <button class="decrease-qty px-2 py-1 border rounded text-xs" data-index="${index}" aria-label="Уменьшить количество ${item.name} размера ${item.size}">−</button>
                                    <span class="quantity mx-2 w-6 text-center text-xs">${item.quantity}</span>
                                    <button class="increase-qty px-2 py-1 border rounded text-xs" data-index="${index}" aria-label="Увеличить количество ${item.name} размера ${item.size}">+</button>
                                </div>
                            </div>
                            <button class="remove-item ml-4 text-gray-400 hover:text-[#3d0a05] transition-smooth" data-index="${index}" aria-label="Удалить ${item.name} размера ${item.size} из корзины">
                                <i class="fas fa-times text-sm"></i>
                            </button>
                        `;
                        cartItems.appendChild(cartItem);
                        total += itemTotal;
                    });
                }

                cartTotal.textContent = `${total.toLocaleString('ru-RU')} ₽`;

                document.querySelectorAll(".decrease-qty").forEach(button => {
                    button.addEventListener("click", function() {
                        const index = parseInt(this.getAttribute("data-index"));
                        if (cart[index].quantity > 1) {
                            cart[index].quantity--;
                        } else {
                            cart.splice(index, 1);
                        }
                        saveAndUpdateCart();
                    });
                });

                document.querySelectorAll(".increase-qty").forEach(button => {
                    button.addEventListener("click", function() {
                        const index = parseInt(this.getAttribute("data-index"));
                        cart[index].quantity++;
                        saveAndUpdateCart();
                    });
                });

                document.querySelectorAll(".remove-item").forEach(button => {
                    button.addEventListener("click", function() {
                        const index = parseInt(this.getAttribute("data-index"));
                        cart.splice(index, 1);
                        saveAndUpdateCart();
                    });
                });
            }

            function saveAndUpdateCart() {
                localStorage.setItem("cart", JSON.stringify(cart));
                updateCart();
                updateCartCount();
                // Обновление заголовка страницы
                const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
                document.title = `SHYNEMOSCOW | HOODIE_01 (${totalItems} в корзине)`;
            }

            function updateCartCount() {
                const totalItems = cart.reduce((total, item) => total + item.quantity, 0);
                if (totalItems > 0) {
                    cartCount.textContent = totalItems;
                    cartCount.classList.remove("hidden");
                } else {
                    cartCount.classList.add("hidden");
                }
            }

            function updateSlidePosition() {
                slides.style.transform = `translateX(${-currentIndex * 100}%)`;
            }

            function updateActiveThumbnail() {
                thumbnails.forEach((thumb, i) => {
                    thumb.classList.toggle("active", i === currentIndex);
                });
            }

            function updateDotIndicator() {
                dotIndicators.forEach((dot, i) => {
                    dot.classList.toggle("bg-[#3d0a05]", i === currentIndex);
                    dot.classList.toggle("bg-white/80", i !== currentIndex);
                    dot.setAttribute("aria-selected", i === currentIndex ? "true" : "false");
                });
            }

            // Проверка оплаты
            const urlParams = new URLSearchParams(window.location.search);
            const idempotenceKey = urlParams.get('payment_id');

            async function checkPaymentStatus(idempotenceKey, retries = 3, delay = 2000) {
                for (let i = 0; i < retries; i++) {
                    try {
                        const response = await fetch(`/check-payment-status.php?idempotenceKey=${idempotenceKey}`);
                        if (!response.ok) {
                            throw new Error(`Ошибка HTTP: ${response.status}`);
                        }
                        const data = await response.json();
                        if (data.status === 'succeeded') {
                            return { status: 'succeeded', paymentId: data.paymentId };
                        } else if (data.status === 'canceled' || data.status === 'failed') {
                            return { status: data.status, paymentId: data.paymentId };
                        }
                        if (i < retries - 1) {
                            await new Promise(resolve => setTimeout(resolve, delay));
                        }
                    } catch (error) {
                        console.error("Ошибка при проверке статуса платежа:", error);
                        if (i < retries - 1) {
                            await new Promise(resolve => setTimeout(resolve, delay));
                        } else {
                            return null;
                        }
                    }
                }
                return null;
            }

            if (idempotenceKey) {
                checkPaymentStatus(idempotenceKey).then(result => {
                    if (result && result.status === 'succeeded') {
                        console.log("Платеж успешен, очищаем корзину");
                        openModal(successPopup);
                        document.getElementById("order-number").textContent = result.paymentId;

                        cart = [];
                        localStorage.removeItem('cart');
                        localStorage.removeItem('orderData');
                        updateCart();
                        updateCartCount();
                    } else {
                        console.log("Не удалось проверить статус платежа или платеж неуспешен");
                        openModal(errorPopup);
                    }

                    window.history.replaceState({}, document.title, window.location.pathname);
                }).catch(error => {
                    console.error("Критическая ошибка при проверке платежа:", error);
                    openModal(errorPopup);
                });
            }

            closeSuccessPopupBtn.addEventListener("click", () => closeModal(successPopup));
            closeErrorPopupBtn.addEventListener("click", () => closeModal(errorPopup));

            successPopup.addEventListener("click", (e) => {
                if (e.target === successPopup) closeModal(successPopup);
            });

            errorPopup.addEventListener("click", (e) => {
                if (e.target === errorPopup) closeModal(errorPopup);
            });

            // Закрытие модальных окон по клавише Escape
            document.addEventListener("keydown", (e) => {
                if (e.key === "Escape") {
                    closeModal(imagePopup);
                    closeModal(cartModal);
                    closeModal(sizeGuideModal);
                    closeModal(contactsModal);
                    closeModal(successPopup);
                    closeModal(errorPopup);
                }
            });
        });
    </script>
    <script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9334581b2d49bcc8',t:'MTc0NTE0ODk4OC4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'9334eeb0394eb004',t:'MTc0NTE1NTE1Ni4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>
<script>(function(){function c(){var b=a.contentDocument||a.contentWindow.document;if(b){var d=b.createElement('script');d.innerHTML="window.__CF$cv$params={r:'933523d2791e53d8',t:'MTc0NTE1NzMzMi4wMDAwMDA='};var a=document.createElement('script');a.nonce='';a.src='/cdn-cgi/challenge-platform/scripts/jsd/main.js';document.getElementsByTagName('head')[0].appendChild(a);";b.getElementsByTagName('head')[0].appendChild(d)}}if(document.body){var a=document.createElement('iframe');a.height=1;a.width=1;a.style.position='absolute';a.style.top=0;a.style.left=0;a.style.border='none';a.style.visibility='hidden';document.body.appendChild(a);if('loading'!==document.readyState)c();else if(window.addEventListener)document.addEventListener('DOMContentLoaded',c);else{var e=document.onreadystatechange||function(){};document.onreadystatechange=function(b){e(b);'loading'!==document.readyState&&(document.onreadystatechange=e,c())}}}})();</script>
</body>
</html>